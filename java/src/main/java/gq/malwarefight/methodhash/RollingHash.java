package gq.malwarefight.methodhash;

import java.util.Arrays;

public class RollingHash {
    public static int minBlockSize = 1 << 4; // 16
    public static int spamSumLength = 1 << 5; // 32
    private static final Integer rollingWindow = 1 << 3; // 8

    private Integer x = 0;
    private Integer y = 0;
    private Integer z = 0;
    private Integer c = 0;
    private final Integer[] window = new Integer[rollingWindow];
    public long hash;

    public RollingHash() {
        Arrays.fill(window, 0);
    }

    public void update(byte d) {
        y -= x;
        y += rollingWindow * d;
        x += d;
        x -= window[Integer.remainderUnsigned(c, rollingWindow)];
        window[Integer.remainderUnsigned(c, rollingWindow)] = (int) d;
        c++;
        z = z << 5;
        z = z ^ d;
        hash = Integer.toUnsignedLong(x + y + z);
    }
}
